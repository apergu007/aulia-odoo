<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_sales_orders">
        <t t-call="web.html_container">
            <t t-call="bmo_report.external_layout_custom_noheader">
                <t t-foreach="docs" t-as="o">
                    <style>
                        table.table-sm { 
                            border-top: 1px solid black;
                            border-right: 1px solid black;
                            border-bottom: 1px solid black;
                            border-left: 1px solid black;
                            border-collapse: collapse;
                            margin-top: 0px; width: 100%;
                            table-layout: auto;
                        }
                    </style>
                    <div t-attf-class="header">
                        <t t-set="company" t-value="o.company_id.sudo()"/>
                        <div class="row">
                            <div class="col-6">
                                <img t-if="company.logo" class="o_company_logo_big" t-att-src="image_data_uri(company.logo)" alt="Logo"/>
                                <div t-if="company.report_header" t-field="company.report_header" class="o_company_tagline fw-bold mt-2">Company tagline</div>
                            </div>
                            <div class="col-5">
                                <div class="text-right">
                                    <t t-if="so == 1">
                                        <span style="margin-right:2px;font-weight:bold;">Sales Order No. : </span><span t-esc="o.name"/>
                                    </t>
                                    <t t-if="proforma == 1">
                                        <span style="margin-right:2px;font-weight:bold;">Proforma Invoice No. : </span><span t-esc="o.name"/>
                                    </t>
                                </div>
                            </div>
                            <div class="col-1">
                                <div class="text-right">
                                    <div t-if="report_type == 'pdf'">Page <span class="page"/> / <span class="topage"/></div>
                                    <!-- <div t-if="report_type == 'pdf' and display_name_in_footer" t-out="o.name">(document name)</div> -->
                                </div>
                            </div>
                        </div>
                        <div style="font-size:20px;">
                            <t t-if="so == 1">
                                <span style="margin-right:2px;font-weight:bold;">Sales Order No. : </span><span t-esc="o.name"/>
                            </t>
                            <t t-if="proforma == 1">
                                <span style="margin-right:2px;font-weight:bold;">Proforma Invoice No. : </span><span t-esc="o.name"/>
                            </t>
                        </div>
                        <br/>
                        <div class="row">
                            <div class="col-6">
                                <div><span style="margin-right:2px;font-weight:bold;">Date. </span><span t-esc="o.date_order.strftime('%d-%B-%Y')"/></div>
                                <div><span style="margin-right:2px;font-weight:bold;">Order No: </span><span t-esc="o.po_number"/></div>
                                <div><span style="margin-right:2px;font-weight:bold;">Sales Person: </span><span t-esc="o.employee_id.name"/></div>
                            </div>
                            <div class="col-6">
                                <div><span style="margin-right:2px;font-weight:bold;">Terms of Payment: </span><span t-esc="o.payment_term_id.name"/></div>
                                <div><span style="margin-right:2px;font-weight:bold;">Due Date: </span><span t-esc="o.validity_date.strftime('%d-%B-%Y')"/></div>
                            </div>
                        </div>
                        <br/>
                        <div class="row">
                            <div class="col-6">
                                <b>Billing Details :</b>
                                <br/>
                                <div t-field="o.partner_id"/>
                                <div t-field="o.partner_id.contact_address_complete"/>
                                <div t-esc="o.partner_id.mobile"/>
                                <div t-esc="o.partner_id.email"/>
                            </div>
                            <div class="col-6">
                                <b>Delivery Address : </b>
                                <br/>
                                <div t-field="o.partner_id.ship_to"/>
                            </div>
                        </div>
                        <br/>
                        <div class="row">
                            <div class="col-8"></div>
                            <div class="col-4">
                                <strong><span>Currency :</span></strong>
                                <span t-esc="o.currency_id.name"/>
                            </div>
                        </div>
                    </div>
                    <div class="page" style="font-size:14px;">
                        <table class="table table-sm" style="page-break-inside: avoid;">
                            <thead>
                                <tr>
                                    <th style="text-align:center;border: 1px solid black;">No</th>
                                    <th style="text-align:center;border: 1px solid black;">Product Code</th>
                                    <th style="text-align:center;border: 1px solid black;">Product Name</th>
                                    <th style="text-align:center;border: 1px solid black;">Qty</th>
                                    <th style="text-align:center;border: 1px solid black;">Unit Price</th>
                                    <th style="text-align:center;border: 1px solid black;">Disc</th>
                                    <th style="text-align:center;border: 1px solid black;">Amount</th>
                                </tr>
                            </thead>
                            <tbody >
                                <t t-set="undis" t-value="0"/>
                                <t t-set="subtotal" t-value="0"/>
                                <t t-set="t_disc" t-value="0"/>
                                <t t-set="deliv_fee" t-value="0"/>
                                <t t-set="dp_fee" t-value="0"/>
                                <t t-set="col" t-value="0"/>
                                <!-- <t t-foreach="o.invoice_line_ids.filtered(lambda l: l.price_unit)" t-as="line"> -->
                                <t t-foreach="o.order_line.filtered(lambda l: l.price_unit > 0)" t-as="line">
                                    <t t-set="col" t-value="col+1"/>
                                    <t t-if="line.name and 'Down Payment' in line.name">
                                        <t t-set="dp_fee" t-value="dp_fee + line.price_unit"/>
                                    </t>
                                    <tr style="border: 1px solid black;height: 20px;">
                                        <td style="border: 1px solid black;text-align:center;">
                                            <span t-esc="col"/>
                                        </td>
                                        <td style="border: 1px solid black;text-align:left;">
                                            <span t-if="line.product_id.default_code" t-esc="line.product_id.default_code"/>
                                        </td>
                                        <td style="border: 1px solid black;text-align:left;">
                                            <t t-if="line.product_id">
                                                <span t-esc="line.product_id.name"/>
                                                <t t-if="'Delivery Fee' in line.product_id.name and line.price_unit">
                                                    <t t-set="deliv_fee" t-value="deliv_fee + line.price_unit"/>
                                                </t>
                                            </t>
                                            <t t-else="">
                                                <span t-esc="line.name"/>
                                            </t>
                                        </td>
                                        <td style="border: 1px solid black;text-align:center;">
                                            <span t-esc="line.product_uom_qty"/> <span t-esc="line.product_id.uom_id.name"/>
                                        </td>
                                        <td style="border: 1px solid black;text-align:right;">
                                            <span t-esc="line.price_unit" t-options='{"widget": "float", "precision": 2}'/>
                                            <!-- <span t-esc="'{0:,.2f}'.format(int(line.price_unit))"/> -->
                                        </td>
                                        <td style="border: 1px solid black;text-align:right;">
                                            <t t-set="disc" t-value="0"/>
                                            <t t-if="float(line.multi_discount) != 0">
                                                <t t-if="line.discount_type == 'percent'">
                                                    <t t-set="disc" t-value="abs(line.price_total - (line.product_uom_qty*line.price_unit))"/>
                                                    <span t-esc="line.multi_discount"/>%
                                                </t>
                                                <t t-if="line.discount_type == 'amount'">
                                                    <t t-set="disc" t-value="float(line.multi_discount)"/>
                                                    <span t-esc="disc" t-options='{"widget": "float", "precision": 2}'/>                                               
                                                </t>
                                            </t>
                                            <t t-else="">
                                                <span style="text-align:center;">-</span>
                                            </t>
                                        </td>
                                        <td style="border: 1px solid black;text-align:right;">
                                            <span t-esc="line.price_subtotal" t-options='{"widget": "float", "precision": 2}'/>
                                            <!-- <span t-esc="'{0:,.2f}'.format(int(line.price_subtotal))"/> -->
                                        </td>
                                    </tr>
                                    <t t-set="t_disc" t-value="t_disc + disc"/>
                                    <t t-set="subtotal" t-value="subtotal + line.price_subtotal"/>
                                </t>
                            </tbody>
                        </table>
                        <div class="row" style="page-break-inside: avoid;">
                            <div class="col-8">
                                <div>
                                    <strong><span>Additional Notes :</span></strong>
                                </div>
                                <div style="height:100px;"><span t-field="o.note"/></div>
                            </div>
                            <div class="col-4">
                                <t t-set="dpp_rumus" t-value="0.0"/>
                                <t t-set="dpp_rumus" t-value="((o.amount_total/1.11) * (11/12))"/>
                                <!-- <t t-set="t_wo_disc" t-value="sum([line.product_uom_qty*line.price_unit for line in o.order_line])"/> -->
                                <t t-set="t_disc" t-value="abs((t_disc*-1) + sum([line.price_total for line in o.order_line if 0 > line.price_total]))"/>
                                <t t-set="sub_total" t-value="sum([line.price_total for line in o.order_line])"/>
                                <t t-set="discount_total" t-value="sum([line.price_subtotal for line in o.order_line])"/>
                                <table class="table table-borderless" style="width:100%;border-collapse: collapse;text-align:right;">
                                    <tr>
                                        <td style="width: 50%;"><strong><span>Sub Total</span></strong></td>
                                        <td>:</td>
                                        <td style="text-align:right;">
                                            <!-- <span t-esc="'{0:,.2f}'.format(int(t_wo_disc))"/> -->
                                            <span t-esc="sub_total" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="width: 50%;"><strong><span>Additional Disc.</span></strong></td>
                                        <td>:</td>
                                        <td style="text-align:right;">
                                            <!-- <span t-esc="'{0:,.2f}'.format(int(t_disc))"/> -->
                                            <span t-esc="t_disc" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong><span>DPP </span></strong></td>
                                        <td>:</td>
                                        <td style="text-align:right;">
                                            <!-- <span t-esc="'{0:,.2f}'.format(int(t_wo_disc-t_disc))"/> -->
                                            <span t-esc="sub_total-t_disc-o.amount_tax" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong><span>PPN </span></strong></td>
                                        <td>:</td>
                                        <td style="text-align:right;">
                                            <!-- <span t-esc="'{0:,.2f}'.format(int(o.amount_tax))"/> -->
                                            <span t-esc="o.amount_tax" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong><span>Delivery Fee</span></strong></td>
                                        <td>:</td>
                                        <td style="text-align:right;">
                                            <!-- <span t-esc="'{0:,.2f}'.format(int(deliv_fee))"/> -->
                                            <span t-esc="deliv_fee" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong><span>Down Payment</span></strong></td>
                                        <td>:</td>
                                        <td style="text-align:right;">
                                            <!-- <span t-esc="'{0:,.2f}'.format(int(dp_fee))"/> -->
                                            <span t-esc="dp_fee" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong><span>Amount Due </span></strong></td>
                                        <td>:</td>
                                        <td style="text-align:right;">
                                            <!-- <span t-esc="'{0:,.2f}'.format(int(o.amount_total))"/> -->
                                            <span t-esc="o.amount_total" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <br/>
                        <div><span style="margin-right:2px;">Please sign &amp; confirm this order by email to</span><span style="color:blue;"> so@auliacosmetic.com</span>.</div>
                        <br/>
                        <div class="row" style="width:100%; page-break-inside: avoid;">
                            <!-- First column -->
                            <div class="col" style="text-align:center; width:25%; border:0px;">
                                <strong><span>Issued by: </span></strong>
                                <div><span t-esc="o.create_uid.name"/></div>
                                <div style="text-align:center; vertical-align: top;">
                                    <span t-esc="(o.create_date + relativedelta(hours=7)).strftime('%d-%B-%Y %H:%M')"/>
                                </div>
                            </div>

                            <!-- Second column -->
                            <div class="col" style="text-align:center; width:25%; border:0px;">
                                <t t-set="finance" t-value="o.approver_ids.filtered(lambda l:l.state == 'approved' and l.role == 'Finance')"/>
                                <strong><span>Finance Approval: </span></strong>
                                <div>
                                    <span t-if="finance" t-esc="finance.user_id.name"/>
                                </div>
                                <div style="text-align:center; vertical-align: top;">
                                    <span t-if="finance" t-esc="(finance.write_date + relativedelta(hours=7)).strftime('%d-%B-%Y %H:%M')"/>
                                </div>
                            </div>

                            <!-- Third column -->
                            <div class="col" style="text-align:center; width:25%; border:0px;">
                                <t t-set="sales" t-value="o.approver_ids.filtered(lambda l:l.state == 'approved' and l.role == 'Sales')"/>
                                <strong><span>Sales Approval: </span></strong>
                                <div>
                                    <span t-if="sales" t-esc="sales.user_id.name"/>
                                </div>
                                <div style="text-align:center; vertical-align: top;">
                                    <span t-if="sales" t-esc="(sales.write_date + relativedelta(hours=7)).strftime('%d-%B-%Y %H:%M')"/>
                                </div>
                            </div>
                            <div class="col" style="text-align:center; width:25%; border:0px;">
                                <strong><span>Customer Approval: </span></strong>
                                <div style="height:60px;"><!-- <span t-esc="o.approver_ids[-1].user_id.name"/> --></div>
                                <div style="text-align:center; vertical-align: top;">
                                    <div>(_____________________________)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="report_so_so">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-set="so" t-value="1"/>
                <t t-call="bmo_report.report_sales_orders" />
            </t>
        </t>
    </template>

    <template id="report_so_proforma">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-set="proforma" t-value="1"/>
                <t t-call="bmo_report.report_sales_orders" />
            </t>
        </t>
    </template>

    <record id="action_report_sales_orders" model="ir.actions.report">
        <field name="name">Report Sales order</field>
        <field name="model">sale.order</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">bmo_report.report_so_so</field>
        <field name="report_file">bmo_report.report_so_so</field>
        <field name="print_report_name">'Sales Order - %s' % object.name</field>
        <field name="binding_model_id" ref="sale.model_sale_order"/>
        <field name="paperformat_id" ref="bmo_report.report_a4_paperformat_header" />
        <field name="binding_type">report</field>
    </record>

    <record id="action_report_proforma_invoice" model="ir.actions.report">
        <field name="name">Report Proforma Invoice</field>
        <field name="model">sale.order</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">bmo_report.report_so_proforma</field>
        <field name="report_file">bmo_report.report_so_proforma</field>
        <field name="print_report_name">'Proforma Invoice - %s' % object.name</field>
        <field name="binding_model_id" ref="sale.model_sale_order"/>
        <field name="paperformat_id" ref="bmo_report.report_a4_paperformat_header" />
        <field name="binding_type">report</field>
    </record>
</odoo>